<!--
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
--><!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.4. Nouveau &mdash; Apache CouchDB® 3.3 Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/rtd_theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://QubitPi.github.io/couchdb/ddocs/nouveau.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Best Practices" href="../best-practices/index.html" />
    <link rel="prev" title="3.3. Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Apache CouchDB®
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
<h2>Table of Contents</h2>

              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication/index.html">2. Replication</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ddocs.html">3.1. Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="views/index.html">3.2. Guide to Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="search.html">3.3. Search</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.4. Nouveau</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#index-functions">3.4.1. Index functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#index-guard-clauses">3.4.1.1. Index guard clauses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#analyzers">3.4.2. Analyzers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#field-analyzers">3.4.2.1. Field analyzers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-analyzer-tokenization">3.4.2.2. Testing analyzer tokenization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#queries">3.4.3. Queries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#query-parameters">3.4.3.1. Query Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relevance">3.4.3.2. Relevance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#posting-search-queries">3.4.3.3. POSTing search queries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#query-syntax">3.4.4. Query syntax</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#faceting">3.4.4.1. Faceting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#counts">3.4.4.2. Counts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ranges">3.4.4.3. Ranges</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../best-practices/index.html">4. Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">2. Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">3. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster/index.html">4. Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">5. Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fauxton/index.html">6. Fauxton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experimental.html">7. Experimental Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">1. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json-structure.html">2. JSON Structure Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query-server/index.html">3. Query Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../partitioned-dbs/index.html">4. Partitioned Databases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">1. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html">2. Security Issues / CVEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html#reporting-new-security-problems-with-apache-couchdb">3. Reporting New Security Problems with Apache CouchDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">4. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">5. Contributing to this Documentation</a></li>
</ul>

<h2>Quick Reference Guides</h2>
<ul>
<li><a href="../http-routingtable.html">API Quick Reference</a></li>
<li><a href="../config-ref.html">Configuration Quick Reference</a></li>
</ul>


<h2>Local Links</h2>
<ul>
<li><a href="../">Fauxton</a></li>
</ul>


<h2>More Help</h2>
<ul>
<li><a href="https://couchdb.apache.org/">CouchDB Homepage</a></li>
<li><a href="https://couchdb.apache.org/#mailing-list">Mailing Lists</a></li>
<li><a href="https://couchdb.apache.org/#chat">Realtime Chat</a></li>
<li><a href="https://github.com/apache/couchdb/issues">Issue Tracker</a></li>
<li><a href="../download.html">Download Docs</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CouchDB®</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">3. </span>Design Documents</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.4. </span>Nouveau</li>
  
    
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ddocs/nouveau.rst.txt" rel="nofollow"> View page source</a>
      </li>
  

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nouveau">
<span id="ddoc-nouveau"></span><h1><span class="section-number">3.4. </span>Nouveau<a class="headerlink" href="#nouveau" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nouveau is an experimental feature. Future releases might change how the endpoints
work and might invalidate existing indexes.</p>
</div>
<p>Nouveau indexes enable you to query a database by using the
<a class="reference external" href="https://lucene.apache.org/core/9_5_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#Overview">Lucene Query Parser Syntax.</a>
A nouveau index uses one, or multiple, fields from your documents. You can use a nouveau
index to run queries to find documents based on the content they contain.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nouveau cannot function unless it has a functioning Nouveau server.
See <a class="reference internal" href="../install/nouveau.html#install-nouveau"><span class="std std-ref">Nouveau Server Installation</span></a> for details.</p>
</div>
<p>To create a nouveau index, you add a JavaScript function to a design document in the
database. An index builds after processing one search request or after the server detects
a document update. The <code class="docutils literal notranslate"><span class="pre">index</span></code> function takes the following parameters:</p>
<ol class="arabic simple">
<li><p>Field type - The type of the field, can be <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">double</span></code>
or <code class="docutils literal notranslate"><span class="pre">stored</span></code>.</p></li>
<li><p>Field name - The name of the field you want to use when you query the index.
If you set this parameter to <code class="docutils literal notranslate"><span class="pre">default</span></code>, then this field is queried if no field is
specified in the query syntax.</p></li>
<li><p>Data that you want to index, for example, <code class="docutils literal notranslate"><span class="pre">doc.address.country</span></code>.</p></li>
<li><p>(Optional) The third parameter includes the following field: <code class="docutils literal notranslate"><span class="pre">store</span></code>.</p></li>
</ol>
<p>By default, a nouveau index response returns 25 rows. The number of hits that are returned
can be changed by using the <code class="docutils literal notranslate"><span class="pre">limit</span></code> parameter. Each response includes a <code class="docutils literal notranslate"><span class="pre">bookmark</span></code>
field. You can include the value of the <code class="docutils literal notranslate"><span class="pre">bookmark</span></code> field in subsequent queries to fetch
results from deeper in the result set.</p>
<p><em>Example design document that defines a nouveau index:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/nouveau_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;nouveau&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;animals&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function(doc){ ... }&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A nouveau index will inherit the partitioning type from the <code class="docutils literal notranslate"><span class="pre">options.partitioned</span></code> field
of the design document that contains it.</p>
<section id="index-functions">
<h2><span class="section-number">3.4.1. </span>Index functions<a class="headerlink" href="#index-functions" title="Permalink to this heading">¶</a></h2>
<p>Attempting to index by using a data field that does not exist fails. To avoid
this problem, use the appropriate
<a class="reference internal" href="#ddoc-nouveau-index-guard-clauses"><span class="std std-ref">guard clause</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your indexing functions operate in a memory-constrained environment
where the document itself forms a part of the memory that is used
in that environment. Your code’s stack and document must fit inside this
memory. In other words, a document must be loaded in order to be indexed.
Documents are limited to a maximum size of 64 MB.</p>
</div>
<p>The function that is contained in the index field is a JavaScript function
that is called for each document in the database.
The function takes the document as a parameter,
extracts some data from it, and then calls the function that is defined
in the <code class="docutils literal notranslate"><span class="pre">index</span></code> field to index that data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">index</span></code> function takes four parameters, where the third parameter is optional.</p>
<ol class="arabic">
<li><p>The first parameter is the type of the field.</p></li>
<li><p>The second parameter is the name of the field you intend to use
when querying the index, and which is specified in the Lucene
syntax portion of subsequent queries.  An example appears in the
following query:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">q</span><span class="o">=</span><span class="nx">color</span><span class="o">:</span><span class="nx">red</span>
</pre></div>
</div>
<p>The Lucene field name <code class="docutils literal notranslate"><span class="pre">color</span></code> is the first parameter of the <code class="docutils literal notranslate"><span class="pre">index</span></code> function.</p>
<p>If the special value <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> is used when you define the name,
you do not have to specify a field name at query time.
The effect is that the query can be simplified:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">q</span><span class="o">=</span><span class="nx">red</span>
</pre></div>
</div>
</li>
<li><p>The third parameter is the data to be indexed. Keep the following information
in mind when you index your data:</p>
<ul class="simple">
<li><p>This data must be only a string, number, or boolean. Other types will cause
an error to be thrown by the index function call.</p></li>
<li><p>If an error is thrown when running your function, for this reason or others,
the document will not be added to that search index.</p></li>
</ul>
</li>
<li><p>The fourth, optional, parameter is a JavaScript object with the following fields:</p>
<p><em>Index function (optional parameter)</em></p>
<ul class="simple">
<li><p><strong>store</strong> - If <code class="docutils literal notranslate"><span class="pre">true</span></code>, the value is returned in the search result; otherwise,
the value is not returned. Values are <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not set the <code class="docutils literal notranslate"><span class="pre">store</span></code> parameter,
the index data results for the document are not returned in response to a query.</p>
</div>
</li>
</ol>
<p><em>Example search index function:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">diet</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;diet&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">diet</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">latin_name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;latin_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">latin_name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="kd">class</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="kd">class</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="index-guard-clauses">
<span id="ddoc-nouveau-index-guard-clauses"></span><h3><span class="section-number">3.4.1.1. </span>Index guard clauses<a class="headerlink" href="#index-guard-clauses" title="Permalink to this heading">¶</a></h3>
<p>Runtime errors in the index function cause the document not to be indexed at all. The
most common runtime errors are described below;</p>
<p><em>Example of failing to check whether the indexed value exists:</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>example of bad code</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
</pre></div>
</div>
<p>For documents without a <cite>min_length</cite> value, this index call will
pass <code class="docutils literal notranslate"><span class="pre">undefined</span></code> as the value. This will be rejected by nouveau’s
validation function and the document will not be indexed.</p>
<p><em>Example of failing to check whether the nested indexed value exists:</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>example of bad code</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This bad example fails in a different way if <code class="docutils literal notranslate"><span class="pre">doc.foo</span></code> doesn’t
exist; the evaluation of <code class="docutils literal notranslate"><span class="pre">doc.foo.bar</span></code> throws an exception.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example correctly checks that <code class="docutils literal notranslate"><span class="pre">doc.foo</span></code> is an object and its
<code class="docutils literal notranslate"><span class="pre">bar</span></code> entry is a string.</p>
<p><em>Example of checking the index value exists but disallowing valid false values:</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>example of bad code</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We correct the previous mistake so documents without min_length are
indexed (assuming there are other index calls for values that <cite>do</cite>
exist) but we’ve acccidentally prevented the indexing of the
<code class="docutils literal notranslate"><span class="pre">min_length</span></code> field if the <code class="docutils literal notranslate"><span class="pre">doc.min_length</span></code> happens to be <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">min_length</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;store&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This good example ensures we index any document where <code class="docutils literal notranslate"><span class="pre">min_length</span></code> is a number.</p>
</section>
</section>
<section id="analyzers">
<span id="ddoc-nouveau-analyzers"></span><h2><span class="section-number">3.4.2. </span>Analyzers<a class="headerlink" href="#analyzers" title="Permalink to this heading">¶</a></h2>
<p>Analyzers convert textual input into <code class="docutils literal notranslate"><span class="pre">tokens</span></code> which can be searched
on. Analyzers typically have different rules for how they break up
input into tokens, they might convert all text to lower case, they
might omit whole words (typically words so common they are unlikely to
be useful for searching), they might omit parts of words (removing
<code class="docutils literal notranslate"><span class="pre">ing</span></code> suffixes in English, for example):</p>
<p>We expose a large number of Lucene’s analyzers. We invent one
ourselves (<code class="docutils literal notranslate"><span class="pre">simple_asciifolding</span></code>);</p>
<ul class="simple">
<li><p>arabic</p></li>
<li><p>armenian</p></li>
<li><p>basque</p></li>
<li><p>bulgarian</p></li>
<li><p>catalan</p></li>
<li><p>chinese</p></li>
<li><p>cjk</p></li>
<li><p>classic</p></li>
<li><p>czech</p></li>
<li><p>danish</p></li>
<li><p>dutch</p></li>
<li><p>email</p></li>
<li><p>english</p></li>
<li><p>finnish</p></li>
<li><p>french</p></li>
<li><p>galician</p></li>
<li><p>german</p></li>
<li><p>hindi</p></li>
<li><p>hungarian</p></li>
<li><p>indonesian</p></li>
<li><p>irish</p></li>
<li><p>italian</p></li>
<li><p>japanese</p></li>
<li><p>keyword</p></li>
<li><p>latvian</p></li>
<li><p>norwegian</p></li>
<li><p>persian</p></li>
<li><p>polish</p></li>
<li><p>portugese</p></li>
<li><p>romanian</p></li>
<li><p>russian</p></li>
<li><p>simple</p></li>
<li><p>simple_asciifolding</p></li>
<li><p>spanish</p></li>
<li><p>standard</p></li>
<li><p>swedish</p></li>
<li><p>thai</p></li>
<li><p>turkish</p></li>
<li><p>whitespace</p></li>
</ul>
<p><em>Example analyzer document:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/analyzer_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;nouveau&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;INDEX_NAME&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function (doc) { ... }&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;default_analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ANALYZER_NAME&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="field-analyzers">
<span id="ddoc-nouveau-field-analyzers"></span><h3><span class="section-number">3.4.2.1. </span>Field analyzers<a class="headerlink" href="#field-analyzers" title="Permalink to this heading">¶</a></h3>
<p>You may optionally specify a different analyzer for a specific field.</p>
<p><em>Example of defining different analyzers for different fields:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;_design/analyzer_example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;nouveau&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;INDEX_NAME&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;default_analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;english&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;field_analyzers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;spanish&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;spanish&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;german&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;german&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;function (doc) { ... }&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="testing-analyzer-tokenization">
<h3><span class="section-number">3.4.2.2. </span>Testing analyzer tokenization<a class="headerlink" href="#testing-analyzer-tokenization" title="Permalink to this heading">¶</a></h3>
<p>You can test the results of analyzer tokenization by posting sample data to the
<code class="docutils literal notranslate"><span class="pre">_nouveau_analyze</span></code> endpoint.</p>
<p><em>Example of using HTTP to test the keyword analyzer:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/_nouveau_analyze</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">{&quot;analyzer&quot;</span><span class="o">:</span><span class="l">&quot;keyword&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}</span>
</pre></div>
</div>
<p><em>Example of using the command line to test the keyword analyzer:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/_nouveau_analyze&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;analyzer&quot;:&quot;keyword&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}&#39;</span>
</pre></div>
</div>
<p><em>Result of testing the keyword analyzer:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;tokens&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ablanks@renovations.com&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example of using HTTP to test the standard analyzer:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/_nouveau_analyze</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">{&quot;analyzer&quot;</span><span class="o">:</span><span class="l">&quot;standard&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}</span>
</pre></div>
</div>
<p><em>Example of using the command line to test the standard analyzer:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/_nouveau_analyze&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;analyzer&quot;:&quot;standard&quot;, &quot;text&quot;:&quot;ablanks@renovations.com&quot;}&#39;</span>
</pre></div>
</div>
<p><em>Result of testing the standard analyzer:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;tokens&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ablanks&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;renovations.com&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="queries">
<h2><span class="section-number">3.4.3. </span>Queries<a class="headerlink" href="#queries" title="Permalink to this heading">¶</a></h2>
<p>After you create a search index, you can query it.</p>
<ul class="simple">
<li><p>Issue a partition query using:
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/$DATABASE/_partition/$PARTITION_KEY/_design/$DDOC/_nouveau/$INDEX_NAME</span></code></p></li>
<li><p>Issue a global query using:
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/$DATABASE/_design/$DDOC/_nouveau/$INDEX_NAME</span></code></p></li>
</ul>
<p>Specify your search by using the <code class="docutils literal notranslate"><span class="pre">q</span></code> parameter.</p>
<p><em>Example of using HTTP to query a partitioned index:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/$DATABASE/_partition/$PARTITION_KEY/_design/$DDOC/_nouveau/$INDEX_NAME?include_docs=true&amp;q=*:*&amp;limit=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using HTTP to query a global index:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/$DATABASE/_design/$DDOC/_nouveau/$INDEX_NAME?include_docs=true&amp;q=*:*&amp;limit=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using the command line to query a partitioned index:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>https://<span class="nv">$HOST</span>:5984/<span class="nv">$DATABASE</span>/_partition/<span class="nv">$PARTITION_KEY</span>/_design/<span class="nv">$DDOC</span>/
_nouveau/<span class="nv">$INDEX_NAME</span>?include_docs<span class="o">=</span>true<span class="se">\&amp;</span><span class="nv">q</span><span class="o">=</span>*:*<span class="se">\&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<p><em>Example of using the command line to query a global index:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>https://<span class="nv">$HOST</span>:5984/<span class="nv">$DATABASE</span>/_design/<span class="nv">$DDOC</span>/_nouveau/<span class="nv">$INDEX_NAME</span>?
<span class="nv">include_docs</span><span class="o">=</span>true<span class="se">\&amp;</span><span class="nv">q</span><span class="o">=</span>*:*<span class="se">\&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<section id="query-parameters">
<span id="ddoc-nouveau-query-parameters"></span><h3><span class="section-number">3.4.3.1. </span>Query Parameters<a class="headerlink" href="#query-parameters" title="Permalink to this heading">¶</a></h3>
<p>A full list of query parameters can be found in the
<a class="reference internal" href="../api/ddoc/nouveau.html#api-ddoc-nouveau"><span class="std std-ref">API Reference</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not combine the <code class="docutils literal notranslate"><span class="pre">bookmark</span></code> and <code class="docutils literal notranslate"><span class="pre">update</span></code> options. These options
constrain the choice of shard replicas to use for the response. When used
together, the options might cause problems when contact is attempted
with replicas that are slow or not available.</p>
</div>
</section>
<section id="relevance">
<h3><span class="section-number">3.4.3.2. </span>Relevance<a class="headerlink" href="#relevance" title="Permalink to this heading">¶</a></h3>
<p>When more than one result might be returned, it is possible for them to be sorted. By
default, the sorting order is determined by ‘relevance’.</p>
<p>Relevance is measured according to <a class="reference external" href="https://lucene.apache.org/core/9_5_0/core/org/apache/lucene/search/package-summary.html">Apache Lucene Scoring</a>.
As an example, if you search a simple database for the word
<code class="docutils literal notranslate"><span class="pre">example</span></code>, two documents might contain the word. If one document
mentions the word <code class="docutils literal notranslate"><span class="pre">example</span></code> 10 times, but the second document
mentions it only twice, then the first document is considered to be
more ‘relevant’.</p>
<p>If you do not provide a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, relevance is used by default. The highest
scoring matches are returned first.</p>
<p>If you provide a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, then matches are returned in that order, ignoring
relevance.</p>
<p>If you want to use a <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter, and also include ordering by relevance in your
search results, use the special fields <code class="docutils literal notranslate"><span class="pre">-&lt;score&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;score&gt;</span></code> within the <code class="docutils literal notranslate"><span class="pre">sort</span></code>
parameter.</p>
</section>
<section id="posting-search-queries">
<h3><span class="section-number">3.4.3.3. </span>POSTing search queries<a class="headerlink" href="#posting-search-queries" title="Permalink to this heading">¶</a></h3>
<p>Instead of using the <code class="docutils literal notranslate"><span class="pre">GET</span></code> HTTP method, you can also use <code class="docutils literal notranslate"><span class="pre">POST</span></code>. The main advantage of
<code class="docutils literal notranslate"><span class="pre">POST</span></code> queries is that they can have a request body, so you can specify the request as a
JSON object. Each parameter in the query string of a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request corresponds to a
field in the JSON object in the request body.</p>
<p><em>Example of using HTTP to POST a search request:</em></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/db/_design/ddoc/_nouveau/searchname</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p><em>Example of using the command line to POST a search request:</em></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://$HOST:5984/db/_design/ddoc/_nouveau/searchname&#39;</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="w"> </span>@search.json
</pre></div>
</div>
<p><em>Example JSON document that contains a search request:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;q&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;index:my query&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;sort&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="query-syntax">
<h2><span class="section-number">3.4.4. </span>Query syntax<a class="headerlink" href="#query-syntax" title="Permalink to this heading">¶</a></h2>
<p>The CouchDB search query syntax is based on the
<a class="reference external" href="https://lucene.apache.org/core/9_5_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html">Lucene syntax.</a>
Search queries take the form of <code class="docutils literal notranslate"><span class="pre">name:value</span></code> unless the name is omitted, in which case
they use the default field, as demonstrated in the following examples:</p>
<p><em>Example search query expressions:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Birds</span>
<span class="kd">class</span><span class="o">:</span><span class="nx">bird</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Animals that begin with the letter &quot;l&quot;
l*
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Carnivorous birds
class:bird AND diet:carnivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Herbivores that start with letter &quot;l&quot;
l* AND diet:herbivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Medium-sized herbivores
min_length:[1 TO 3] AND diet:herbivore
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Herbivores that are 2m long or less
diet:herbivore AND min_length:[-Infinity TO 2]
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Mammals that are at least 1.5m long
class:mammal AND min_length:[1.5 TO Infinity]
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Find &quot;Meles meles&quot;
latin_name:&quot;Meles meles&quot;
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Mammals who are herbivore or carnivore
diet:(herbivore OR omnivore) AND class:mammal
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// Return all results
*:*
</pre></div>
</div>
<p>Queries over multiple fields can be logically combined, and groups and fields can be
further grouped. The available logical operators are case-sensitive and are <code class="docutils literal notranslate"><span class="pre">AND</span></code>,
<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">OR</span></code>, <code class="docutils literal notranslate"><span class="pre">NOT</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>. Range queries can run over strings or numbers.</p>
<p>If you want a fuzzy search, you can run a query with <code class="docutils literal notranslate"><span class="pre">~</span></code> to find terms like the search
term. For instance, <code class="docutils literal notranslate"><span class="pre">look~</span></code> finds the terms <code class="docutils literal notranslate"><span class="pre">book</span></code> and <code class="docutils literal notranslate"><span class="pre">took</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the lower and upper bounds of a range query are both strings that
contain only numeric digits, the bounds are treated as numbers not as
strings. For example, if you search by using the query
<code class="docutils literal notranslate"><span class="pre">mod_date:[&quot;20170101&quot;</span> <span class="pre">TO</span> <span class="pre">&quot;20171231&quot;]</span></code>, the results include documents
for which <code class="docutils literal notranslate"><span class="pre">mod_date</span></code> is between the numeric values 20170101 and
20171231, not between the strings “20170101” and “20171231”.</p>
</div>
<p>You can alter the importance of a search term by adding <code class="docutils literal notranslate"><span class="pre">^</span></code> and a positive number. This
alteration makes matches containing the term more or less relevant, proportional to the
power of the boost value. The default value is 1, which means no increase or decrease in
the strength of the match. A decimal value of 0 - 1 reduces importance. making the match
strength weaker. A value greater than one increases importance, making the match strength
stronger.</p>
<p>Wildcard searches are supported, for both single (<code class="docutils literal notranslate"><span class="pre">?</span></code>) and multiple (<code class="docutils literal notranslate"><span class="pre">*</span></code>) character
searches. For example, <code class="docutils literal notranslate"><span class="pre">dat?</span></code> would match <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">dat*</span></code> would
match <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">database</span></code>, and <code class="docutils literal notranslate"><span class="pre">dates</span></code>. Wildcards must come after the
search term.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">*:*</span></code> to return all results.</p>
<p>The following characters require escaping if you want to search on them:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>+<span class="w"> </span>-<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>!<span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>^<span class="w"> </span><span class="s2">&quot; ~ * ? : \ /</span>
</pre></div>
</div>
<p>To escape one of these characters, use a preceding backslash character (<code class="docutils literal notranslate"><span class="pre">\</span></code>).</p>
<p>The response to a search query contains an <code class="docutils literal notranslate"><span class="pre">order</span></code> field for each of the results. The
<code class="docutils literal notranslate"><span class="pre">order</span></code> field is an array where the first element is the field or fields that are
specified in the <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter. See the
<a class="reference internal" href="../api/ddoc/search.html#api-ddoc-search"><span class="std std-ref">sort parameter</span></a>. If no <code class="docutils literal notranslate"><span class="pre">sort</span></code> parameter is included
in the query, then the <code class="docutils literal notranslate"><span class="pre">order</span></code> field contains the <a class="reference external" href="https://lucene.apache.org/core/9_5_0/core/org/apache/lucene/search/package-summary.html">Lucene relevance score</a>.</p>
<section id="faceting">
<span id="ddoc-nouveau-faceting"></span><h3><span class="section-number">3.4.4.1. </span>Faceting<a class="headerlink" href="#faceting" title="Permalink to this heading">¶</a></h3>
<p>Nouveau Search also supports faceted searching, enabling discovery of aggregate
information about matches quickly and easily. You can match all documents by using the
special <code class="docutils literal notranslate"><span class="pre">?q=*:*</span></code> query syntax, and use the returned facets to refine your query.</p>
<p><em>Example of search query:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">price</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To use facets, all the documents in the index must include all the fields that have
faceting enabled. If your documents do not include all the fields, you receive a
<code class="docutils literal notranslate"><span class="pre">bad_request</span></code> error with the following reason, “The <code class="docutils literal notranslate"><span class="pre">field_name</span></code> does not exist.” If
each document does not contain all the fields for facets, create separate indexes for each
field. If you do not create separate indexes for each field, you must include only
documents that contain all the fields. Verify that the fields exist in each document by
using a single <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p>
<p><em>Example if statement to verify that the required fields exist in each document:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">town</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;town&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">town</span><span class="p">);</span>
<span class="w">    </span><span class="nx">index</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="counts">
<h3><span class="section-number">3.4.4.2. </span>Counts<a class="headerlink" href="#counts" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">counts</span></code> option is only available when making global queries.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">counts</span></code> facet syntax takes a list of fields, and returns the number of query
results for each unique value of each named field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">count</span></code> operation works only if the indexed values are strings.
The indexed values cannot be mixed types. For example,
if 100 strings are indexed, and one number,
then the index cannot be used for <code class="docutils literal notranslate"><span class="pre">count</span></code> operations.
You can check the type by using the <code class="docutils literal notranslate"><span class="pre">typeof</span></code> operator, and convert it
by using the <code class="docutils literal notranslate"><span class="pre">parseInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">parseFloat</span></code>, or <code class="docutils literal notranslate"><span class="pre">.toString()</span></code> functions.</p>
</div>
<p><em>Example of a query using the counts facet syntax:</em></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>?q=*:*&amp;counts=[&quot;type&quot;]
</pre></div>
</div>
<p><em>Example response after using of the counts facet syntax:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total_rows&quot;</span><span class="o">:</span><span class="mf">100000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;bookmark&quot;</span><span class="o">:</span><span class="s2">&quot;g...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rows&quot;</span><span class="o">:</span><span class="p">[...],</span>
<span class="w">    </span><span class="s2">&quot;counts&quot;</span><span class="o">:</span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;sofa&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;chair&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;lamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">97</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ranges">
<h3><span class="section-number">3.4.4.3. </span>Ranges<a class="headerlink" href="#ranges" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ranges</span></code> option is only available when making global queries.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> facet syntax reuses the standard Lucene syntax for ranges to return counts
of results that fit into each specified category. Inclusive range queries are denoted by
brackets (<code class="docutils literal notranslate"><span class="pre">[</span></code>, <code class="docutils literal notranslate"><span class="pre">]</span></code>). Exclusive range queries are denoted by curly brackets (<code class="docutils literal notranslate"><span class="pre">{</span></code>,
<code class="docutils literal notranslate"><span class="pre">}</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> operation works only if the indexed values are numbers. The indexed
values cannot be mixed types. For example, if 100 strings are indexed, and one number,
then the index cannot be used for <code class="docutils literal notranslate"><span class="pre">range</span></code> operations. You can check the type by
using the <code class="docutils literal notranslate"><span class="pre">typeof</span></code> operator, and convert it by using the <code class="docutils literal notranslate"><span class="pre">parseInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">parseFloat</span></code>, or <code class="docutils literal notranslate"><span class="pre">.toString()</span></code> functions.</p>
</div>
<p><em>Example of a request that uses faceted search for matching ranges:</em></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>?q=*:*&amp;ranges={&quot;price&quot;:{&quot;cheap&quot;:&quot;[0 TO 100]&quot;,&quot;expensive&quot;:&quot;{100 TO Infinity}&quot;}}
</pre></div>
</div>
<p><em>Example results after a ranges check on a faceted search:</em></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total_rows&quot;</span><span class="o">:</span><span class="mf">100000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;bookmark&quot;</span><span class="o">:</span><span class="s2">&quot;g...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;rows&quot;</span><span class="o">:</span><span class="p">[...],</span>
<span class="w">    </span><span class="s2">&quot;ranges&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;expensive&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">278682</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;cheap&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">257023</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="search.html" class="btn btn-neutral float-left" title="3.3. Search" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../best-practices/index.html" class="btn btn-neutral float-right" title="4. Best Practices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Apache Software Foundation. CouchDB® is a registered trademark of the Apache Software Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>